using DentalClinic.Models;
using DentalClinic.Services;
using MailKit.Net.Smtp;
using System;
using System.Collections.Generic;
using System.Configuration;
using System.Linq;
using System.Net;
using System.Net.Mail;
using System.Threading;
using System.Threading.Tasks;
using System.Web;

namespace DentalClinic.Providers
{
    public class SMSProvider
    {
        //1 - nhắc nhở, 2- đặt lịch thành công
        public static bool SendOTPViaEmail(string email, string code, string title, string message, int typeBody)
        {
            System.Net.Mail.SmtpClient clientDetails = new System.Net.Mail.SmtpClient();
            clientDetails.Port = 587;
            clientDetails.Host = "smtp.gmail.com";
            clientDetails.EnableSsl = true;
            clientDetails.DeliveryMethod = SmtpDeliveryMethod.Network;
            clientDetails.UseDefaultCredentials = false;
            clientDetails.Credentials = new NetworkCredential("thaovu13092001@gmail.com", "sehhnofdtuxvidol");

            //Message Details
            MailMessage mailDetails = new MailMessage();
            mailDetails.From = new MailAddress("thaovu13092001@gmail.com");
            mailDetails.To.Add(email);
            mailDetails.Subject = "[Nha khoa Phương Thảo] " + title;
            mailDetails.IsBodyHtml = true;
            //string path = HttpContext.Current.Server.MapPath("~/Content/files/emailtemplates/Confirm.txt");
            //string body = System.IO.File.ReadAllText(path);
            if (typeBody == 1) mailDetails.Body = "<!DOCTYPE html>\n<html>\n\n<head>\n    <title></title>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <style type=\"text/<a class=\"wpg-linkify wpg-tooltip\" title=\"<h3 class=&quot;wpg-tooltip-title&quot;>What is <span class=&quot;wpg-tooltip-term-title&quot;>CSS</span></h3><div class=&quot;wpg-tooltip-content&quot;>CSS or Cascading Style Sheets is a style sheet language used to define visual appearance and formatting of HTML documents. WordPress themes use CSS and HTML to output the data generated by WordPress. Every WordPress theme contains a style.css file which has style rules to define the formatting of pages generated by WordPress.<p class=&quot;wpg-read-more&quot;><a href=&quot;https://christian-schou.dk/glossary/css/&quot;>Read more..</a></p></div>\" target=\"_blank\">css</a>\">\n        @(\"@\")media screen {\n            @(\"@\")font-face {\n                font-family: 'Lato';\n                font-style: normal;\n                font-weight: 400;\n                src: local('Lato Regular'), local('Lato-Regular'), url(https://fonts.gstatic.com/s/lato/v11/qIIYRU-oROkIk8vfvxw6QvesZW2xOQ-xsNqO47m55DA.woff) format('woff');\n            }\n\n            @(\"@\")font-face {\n                font-family: 'Lato';\n                font-style: normal;\n                font-weight: 700;\n                src: local('Lato Bold'), local('Lato-Bold'), url(https://fonts.gstatic.com/s/lato/v11/qdgUG4U09HnJwhYI-uK18wLUuEpTyoUstqEm5AMlJo4.woff) format('woff');\n            }\n\n            @(\"@\")font-face {\n                font-family: 'Lato';\n                font-style: italic;\n                font-weight: 400;\n                src: local('Lato Italic'), local('Lato-Italic'), url(https://fonts.gstatic.com/s/lato/v11/RYyZNoeFgb0l7W3Vu1aSWOvvDin1pK8aKteLpeZ5c0A.woff) format('woff');\n            }\n\n            @(\"@\")font-face {\n                font-family: 'Lato';\n                font-style: italic;\n                font-weight: 700;\n                src: local('Lato Bold Italic'), local('Lato-BoldItalic'), url(https://fonts.gstatic.com/s/lato/v11/HkF_qI1x_noxlxhrhMQYELO3LdcAZYWl9Si6vvxL-qU.woff) format('woff');\n            }\n        }\n\n        /* CLIENT-SPECIFIC STYLES */\n        body,\n        table,\n        td,\n        a {\n            -webkit-text-size-adjust: 100%;\n            -ms-text-size-adjust: 100%;\n        }\n\n        table,\n        td {\n            mso-table-lspace: 0pt;\n            mso-table-rspace: 0pt;\n        }\n\n        img {\n            -ms-interpolation-mode: bicubic;\n        }\n\n        /* RESET STYLES */\n        img {\n            border: 0;\n            height: auto;\n            line-height: 100%;\n            outline: none;\n            text-decoration: none;\n        }\n\n        table {\n            border-collapse: collapse !important;\n        }\n\n        body {\n            height: 100% !important;\n            margin: 0 !important;\n            padding: 0 !important;\n            width: 100% !important;\n        }\n\n        /* iOS BLUE LINKS */\n        a[x-apple-data-detectors] {\n            color: inherit !important;\n            text-decoration: none !important;\n            font-size: inherit !important;\n            font-family: inherit !important;\n            font-weight: inherit !important;\n            line-height: inherit !important;\n        }\n\n        /* MOBILE STYLES */\n        @(\"@\")media screen and (max-width:600px) {\n            h1 {\n                font-size: 32px !important;\n                line-height: 32px !important;\n            }\n        }\n\n        /* ANDROID CENTER FIX */\n        div[style*=\"margin: 16px 0;\"] {\n            margin: 0 !important;\n        }\n    </style>\n</head>\n\n<body style=\"background-color: #f4f4f4; margin: 0 !important; padding: 0 !important;\">\n    <!-- HIDDEN PREHEADER TEXT -->\n    <div style=\"display: none; font-size: 1px; color: #fefefe; line-height: 1px; font-family: 'Lato', Helvetica, Arial, sans-serif; max-height: 0px; max-width: 0px; opacity: 0; overflow: hidden;\">{{Name}} We're thrilled to have you here! Get ready to dive into your new account. </div>\n    <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\n        <!-- LOGO -->\n        <tr>\n            <td bgcolor=\"#FFA73B\" align=\"center\">\n                <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"max-width: 600px;\">\n                    <tr>\n                        <td align=\"center\" valign=\"top\" style=\"padding: 40px 10px 40px 10px;\"> </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n        <tr>\n            <td bgcolor=\"#FFA73B\" align=\"center\" style=\"padding: 0px 10px 0px 10px;\">\n                <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"max-width: 600px;\">\n                    <tr>\n                        <td bgcolor=\"#ffffff\" align=\"center\" valign=\"top\" style=\"padding: 20px 10px 10px 10px; border-radius: 4px 4px 0px 0px; color: #111111; font-family: 'Lato', Helvetica, Arial, sans-serif; font-size: 20px; font-weight: 400; letter-spacing: 2px; line-height: 24px;\">\n                            <h1 style=\"font-size: 20px; font-weight: 400; margin: 1;\">Welcome {{Name}}!</h1> <img src=\" https://img.icons8.com/clouds/100/000000/handshake.png\" width=\"100\" height=\"80\" style=\"display: block; border: 0px;\" />\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n        <tr>\n            <td bgcolor=\"#f4f4f4\" align=\"center\" style=\"padding: 0px 10px 0px 10px;\">\n                <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"max-width: 600px;\">\n                    <tr>\n                        <td bgcolor=\"#ffffff\" align=\"left\" style=\"padding: 20px 30px 40px 30px; color: #666666; font-family: 'Lato', Helvetica, Arial, sans-serif; font-size: 18px; font-weight: 400; line-height: 25px;\">\n                            <p style=\"margin: 0;\">Chào bạn. Chúng tôi thông báo xác nhận bạn đã đặt cuộc hẹn tại phòng khám nha khoa của chúng tôi. Chúng tôi rất mong được đón tiếp bạn tại phòng khám vào ngày hẹn.</p>\n                        </td>\n                    </tr>\n            \n                    <tr>\n                        <td bgcolor=\"#ffffff\" align=\"left\" style=\"padding: 20px 30px 40px 30px; color: #666666; font-family: 'Lato', Helvetica, Arial, sans-serif; font-size: 18px; font-weight: 400; line-height: 25px;\">\n                            <p style=\"margin: 0;\">Nếu bạn cần thay đổi hoặc hủy bỏ cuộc hẹn, vui lòng liên hệ với chúng tôi trước ngày hẹn của bạn. Điều này sẽ giúp chúng tôi sắp xếp lại lịch trình và đảm bảo rằng chúng tôi có đủ thời gian để phục vụ khách hàng khác.</p>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td bgcolor=\"#ffffff\" align=\"left\" style=\"padding: 0px 30px 20px 30px; color: #666666; font-family: 'Lato', Helvetica, Arial, sans-serif; font-size: 18px; font-weight: 400; line-height: 25px;\">\n                            <p style=\"margin: 0;\">Chúng tôi rất mong chờ sự xuất hiện của bạn và hy vọng rằng chúng tôi có thể cung cấp cho bạn dịch vụ tốt nhất có thể tại phòng khám nha khoa của chúng tôi.\n\nNếu bạn có bất kỳ câu hỏi hoặc yêu cầu nào, xin đừng ngần ngại liên hệ với chúng tôi. Chúc bạn một ngày tốt lành!</p>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td bgcolor=\"#ffffff\" align=\"left\" style=\"padding: 0px 30px 40px 30px; border-radius: 0px 0px 4px 4px; color: #666666; font-family: 'Lato', Helvetica, Arial, sans-serif; font-size: 18px; font-weight: 400; line-height: 25px;\">\n                            <p style=\"margin: 0;\">Trân trọng,<br>Nha Khoa Phương Thảo</p>\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n        \n    </table>\n</body>\n\n</html>";
            if (typeBody == 2) mailDetails.Body = "<!DOCTYPE html>\n<html>\n\n<head>\n    <title></title>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <style type=\"text/<a class=\"wpg-linkify wpg-tooltip\" title=\"<h3 class=&quot;wpg-tooltip-title&quot;>What is <span class=&quot;wpg-tooltip-term-title&quot;>CSS</span></h3><div class=&quot;wpg-tooltip-content&quot;>CSS or Cascading Style Sheets is a style sheet language used to define visual appearance and formatting of HTML documents. WordPress themes use CSS and HTML to output the data generated by WordPress. Every WordPress theme contains a style.css file which has style rules to define the formatting of pages generated by WordPress.<p class=&quot;wpg-read-more&quot;><a href=&quot;https://christian-schou.dk/glossary/css/&quot;>Read more..</a></p></div>\" target=\"_blank\">css</a>\">\n        @(\"@\")media screen {\n            @(\"@\")font-face {\n                font-family: 'Lato';\n                font-style: normal;\n                font-weight: 400;\n                src: local('Lato Regular'), local('Lato-Regular'), url(https://fonts.gstatic.com/s/lato/v11/qIIYRU-oROkIk8vfvxw6QvesZW2xOQ-xsNqO47m55DA.woff) format('woff');\n            }\n\n            @(\"@\")font-face {\n                font-family: 'Lato';\n                font-style: normal;\n                font-weight: 700;\n                src: local('Lato Bold'), local('Lato-Bold'), url(https://fonts.gstatic.com/s/lato/v11/qdgUG4U09HnJwhYI-uK18wLUuEpTyoUstqEm5AMlJo4.woff) format('woff');\n            }\n\n            @(\"@\")font-face {\n                font-family: 'Lato';\n                font-style: italic;\n                font-weight: 400;\n                src: local('Lato Italic'), local('Lato-Italic'), url(https://fonts.gstatic.com/s/lato/v11/RYyZNoeFgb0l7W3Vu1aSWOvvDin1pK8aKteLpeZ5c0A.woff) format('woff');\n            }\n\n            @(\"@\")font-face {\n                font-family: 'Lato';\n                font-style: italic;\n                font-weight: 700;\n                src: local('Lato Bold Italic'), local('Lato-BoldItalic'), url(https://fonts.gstatic.com/s/lato/v11/HkF_qI1x_noxlxhrhMQYELO3LdcAZYWl9Si6vvxL-qU.woff) format('woff');\n            }\n        }\n\n        /* CLIENT-SPECIFIC STYLES */\n        body,\n        table,\n        td,\n        a {\n            -webkit-text-size-adjust: 100%;\n            -ms-text-size-adjust: 100%;\n        }\n\n        table,\n        td {\n            mso-table-lspace: 0pt;\n            mso-table-rspace: 0pt;\n        }\n\n        img {\n            -ms-interpolation-mode: bicubic;\n        }\n\n        /* RESET STYLES */\n        img {\n            border: 0;\n            height: auto;\n            line-height: 100%;\n            outline: none;\n            text-decoration: none;\n        }\n\n        table {\n            border-collapse: collapse !important;\n        }\n\n        body {\n            height: 100% !important;\n            margin: 0 !important;\n            padding: 0 !important;\n            width: 100% !important;\n        }\n\n        /* iOS BLUE LINKS */\n        a[x-apple-data-detectors] {\n            color: inherit !important;\n            text-decoration: none !important;\n            font-size: inherit !important;\n            font-family: inherit !important;\n            font-weight: inherit !important;\n            line-height: inherit !important;\n        }\n\n        /* MOBILE STYLES */\n        @(\"@\")media screen and (max-width:600px) {\n            h1 {\n                font-size: 32px !important;\n                line-height: 32px !important;\n            }\n        }\n\n        /* ANDROID CENTER FIX */\n        div[style*=\"margin: 16px 0;\"] {\n            margin: 0 !important;\n        }\n    </style>\n</head>\n\n<body style=\"background-color: #f4f4f4; margin: 0 !important; padding: 0 !important;\">\n    <!-- HIDDEN PREHEADER TEXT -->\n    <div style=\"display: none; font-size: 1px; color: #fefefe; line-height: 1px; font-family: 'Lato', Helvetica, Arial, sans-serif; max-height: 0px; max-width: 0px; opacity: 0; overflow: hidden;\">{{Name}} We're thrilled to have you here! Get ready to dive into your new account. </div>\n    <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\n        <!-- LOGO -->\n        <tr>\n            <td bgcolor=\"#FFA73B\" align=\"center\">\n                <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"max-width: 600px;\">\n                    <tr>\n                        <td align=\"center\" valign=\"top\" style=\"padding: 40px 10px 40px 10px;\"> </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n        <tr>\n            <td bgcolor=\"#FFA73B\" align=\"center\" style=\"padding: 0px 10px 0px 10px;\">\n                <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"max-width: 600px;\">\n                    <tr>\n                        <td bgcolor=\"#ffffff\" align=\"center\" valign=\"top\" style=\"padding: 20px 10px 10px 10px; border-radius: 4px 4px 0px 0px; color: #111111; font-family: 'Lato', Helvetica, Arial, sans-serif; font-size: 20px; font-weight: 400; letter-spacing: 2px; line-height: 24px;\">\n                            <h1 style=\"font-size: 20px; font-weight: 400; margin: 1;\">Welcome {{Name}}!</h1> <img src=\" https://img.icons8.com/clouds/100/000000/handshake.png\" width=\"100\" height=\"80\" style=\"display: block; border: 0px;\" />\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n        <tr>\n            <td bgcolor=\"#f4f4f4\" align=\"center\" style=\"padding: 0px 10px 0px 10px;\">\n                <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"max-width: 600px;\">\n                    <tr>\n                        <td bgcolor=\"#ffffff\" align=\"left\" style=\"padding: 20px 30px 40px 30px; color: #666666; font-family: 'Lato', Helvetica, Arial, sans-serif; font-size: 18px; font-weight: 400; line-height: 25px;\">\n                            <p style=\"margin: 0;\">Chào bạn. Chúng tôi muốn nhắc nhở bạn về lịch hẹn của mình tại phòng khám nha khoa của chúng tôi. Đây là một lời nhắc nhở thân thiện để đảm bảo rằng bạn không bỏ lỡ cuộc hẹn của mình.</p>\n                        </td>\n                    </tr>\n            \n                    <tr>\n                        <td bgcolor=\"#ffffff\" align=\"left\" style=\"padding: 20px 30px 40px 30px; color: #666666; font-family: 'Lato', Helvetica, Arial, sans-serif; font-size: 18px; font-weight: 400; line-height: 25px;\">\n                            <p style=\"margin: 0;\">Nếu bạn cần thay đổi hoặc hủy bỏ cuộc hẹn, vui lòng liên hệ với chúng tôi để chúng tôi có thể sắp xếp lại lịch trình của mình. Bất cứ khi nào bạn cần sự giúp đỡ hoặc có bất kỳ câu hỏi nào về dịch vụ của chúng tôi, xin đừng ngần ngại liên hệ với chúng tôi.</p>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td bgcolor=\"#ffffff\" align=\"left\" style=\"padding: 0px 30px 20px 30px; color: #666666; font-family: 'Lato', Helvetica, Arial, sans-serif; font-size: 18px; font-weight: 400; line-height: 25px;\">\n                            <p style=\"margin: 0;\">Cảm ơn bạn đã tin tưởng và sử dụng dịch vụ của phòng khám nha khoa của chúng tôi. Chúc bạn một ngày tốt lành!</p>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td bgcolor=\"#ffffff\" align=\"left\" style=\"padding: 0px 30px 40px 30px; border-radius: 0px 0px 4px 4px; color: #666666; font-family: 'Lato', Helvetica, Arial, sans-serif; font-size: 18px; font-weight: 400; line-height: 25px;\">\n                            <p style=\"margin: 0;\">Trân trọng,<br>Nha Khoa Phương Thảo</p>\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n        \n    </table>\n</body>\n\n</html>";
            mailDetails.Body = mailDetails.Body.Replace("{{Name}}", email);
            //mailDetails.Body = body;
            clientDetails.Send(mailDetails);
            return true;
        }
        public class SMSResponse
        {
            public string CodeResult { get; set; }
            public string CountRegenerate { get; set; }
            public string SMSID { get; set; }
        }
    }
}